<!DOCTYPE html>
<!-- saved from url=(0063)https://innlogging.nrk.no/nonstandard/opsession?d=1742543846394 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>OP Session IFrame</title>

<script>(window.BOOMR_mq=window.BOOMR_mq||[]).push(["addVar",{"rua.upush":"false","rua.cpush":"false","rua.upre":"false","rua.cpre":"false","rua.uprl":"false","rua.cprl":"false","rua.cprf":"false","rua.trans":"SJ-0a2d8688-a548-4392-994d-540e29bbd734","rua.cook":"true","rua.ims":"false","rua.ufprl":"false","rua.cfprl":"false","rua.isuxp":"false","rua.texp":"norulematch","rua.ceh":"false","rua.ueh":"false","rua.ieh.st":"0"}]);</script>
                              <script>!function(e){var n="https://s.go-mpulse.net/boomerang/";if("False"=="True")e.BOOMR_config=e.BOOMR_config||{},e.BOOMR_config.PageParams=e.BOOMR_config.PageParams||{},e.BOOMR_config.PageParams.pci=!0,n="https://s2.go-mpulse.net/boomerang/";if(window.BOOMR_API_key="PNWPX-BE9G3-4DHZY-UN976-FJCP7",function(){function e(){if(!r){var e=document.createElement("script");e.id="boomr-scr-as",e.src=window.BOOMR.url,e.async=!0,o.appendChild(e),r=!0}}function t(e){r=!0;var n,t,a,i,d=document,O=window;if(window.BOOMR.snippetMethod=e?"if":"i",t=function(e,n){var t=d.createElement("script");t.id=n||"boomr-if-as",t.src=window.BOOMR.url,BOOMR_lstart=(new Date).getTime(),e=e||d.body,e.appendChild(t)},!window.addEventListener&&window.attachEvent&&navigator.userAgent.match(/MSIE [67]\./))return window.BOOMR.snippetMethod="s",void t(o,"boomr-async");a=document.createElement("IFRAME"),a.src="about:blank",a.title="",a.role="presentation",a.loading="eager",i=(a.frameElement||a).style,i.width=0,i.height=0,i.border=0,i.display="none",o.appendChild(a);try{O=a.contentWindow,d=O.document.open()}catch(_){n=document.domain,a.src="javascript:var d=document.open();d.domain='"+n+"';void 0;",O=a.contentWindow,d=O.document.open()}if(n)d._boomrl=function(){this.domain=n,t()},d.write("<bo"+"dy onload='document._boomrl();'>");else if(O._boomrl=function(){t()},O.addEventListener)O.addEventListener("load",O._boomrl,!1);else if(O.attachEvent)O.attachEvent("onload",O._boomrl);d.close()}function a(e){window.BOOMR_onload=e&&e.timeStamp||(new Date).getTime()}if(!window.BOOMR||!window.BOOMR.version&&!window.BOOMR.snippetExecuted){window.BOOMR=window.BOOMR||{},window.BOOMR.snippetStart=(new Date).getTime(),window.BOOMR.snippetExecuted=!0,window.BOOMR.snippetVersion=14,window.BOOMR.url=n+"PNWPX-BE9G3-4DHZY-UN976-FJCP7";var i=document.currentScript||document.getElementsByTagName("script")[0],o=i.parentNode,r=!1,d=document.createElement("link");if(d.relList&&"function"==typeof d.relList.supports&&d.relList.supports("preload")&&"as"in d)window.BOOMR.snippetMethod="p",d.href=window.BOOMR.url,d.rel="preload",d.as="script",d.addEventListener("load",e),d.addEventListener("error",function(){t(!0)}),setTimeout(function(){if(!r)t(!0)},3e3),BOOMR_lstart=(new Date).getTime(),o.appendChild(d);else t(!1);if(window.addEventListener)window.addEventListener("load",a,!1);else if(window.attachEvent)window.attachEvent("onload",a)}}(),"".length>0)if(e&&"performance"in e&&e.performance&&"function"==typeof e.performance.setResourceTimingBufferSize)e.performance.setResourceTimingBufferSize();!function(){if(BOOMR=e.BOOMR||{},BOOMR.plugins=BOOMR.plugins||{},!BOOMR.plugins.AK){var n="false"=="true"?1:0,t="cookiepresent",a="srjin623q4rccz65dpta-f-06db3a156-clientnsv4-s.akamaihd.net",i="false"=="true"?2:1,o={"ak.v":"39","ak.cp":"1762524","ak.ai":parseInt("856973",10),"ak.ol":"0","ak.cr":6,"ak.ipv":4,"ak.proto":"h2","ak.rid":"c2ed6f","ak.r":20924,"ak.a2":n,"ak.m":"dscr","ak.n":"ff","ak.bpcip":"148.82.134.0","ak.cport":21118,"ak.gh":"91.135.34.29","ak.quicv":"","ak.tlsv":"tls1.3","ak.0rtt":"","ak.0rtt.ed":"","ak.csrc":"-","ak.acc":"","ak.t":"1742543846","ak.ak":"hOBiQwZUYzCg5VSAfCLimQ==VsZw1FvMGPIQv+PbEzVhcPnzYP5PP/deFkou5xAA3FV9niLx1W+sLwl1L71oGKDnK6s8mIKBKIle3OSFwoHPPDkII3kon0FfK1sW51kK9gK5jZuRYV7lZUkq9pYwLpa/ksNBm0UvU8JowZlTeGWSexKYjVhpYOuzUbR2DWNzgpqv/A0uBeHCHhevxPeNz6fkOh8wVxG+PpKQXmJcGg3F6hS96ZG+rGniTB4S/qc4eVpeqf9BY9yA+bQG54desfJzcqHszztZ3NoBK9vlDGjwvjZTlo+LB4SnNN9O6QcF1VmQFFxK0tvxBhrGlEYRlSoji4lXF8RDgcFrJNMzDUnmBl2JyARxNIy+CMidU/xiggY+q0Sdpi8utcpIMIF/5a6kd73fh2Z4g9fYOdLqtC+zJUa5PfviYg7FroF2E06rLFw=","ak.pv":"15","ak.dpoabenc":"","ak.tf":i};if(""!==t)o["ak.ruds"]=t;var r={i:!1,av:function(n){var t="http.initiator";if(n&&(!n[t]||"spa_hard"===n[t]))o["ak.feo"]=void 0!==e.aFeoApplied?1:0,BOOMR.addVar(o)},rv:function(){var e=["ak.bpcip","ak.cport","ak.cr","ak.csrc","ak.gh","ak.ipv","ak.m","ak.n","ak.ol","ak.proto","ak.quicv","ak.tlsv","ak.0rtt","ak.0rtt.ed","ak.r","ak.acc","ak.t","ak.tf"];BOOMR.removeVar(e)}};BOOMR.plugins.AK={akVars:o,akDNSPreFetchDomain:a,init:function(){if(!r.i){var e=BOOMR.subscribe;e("before_beacon",r.av,null,null),e("onbeacon",r.rv,null,null),r.i=!0}return this},is_complete:function(){return!0}}}}()}(window);</script><link href="./PNWPX-BE9G3-4DHZY-UN976-FJCP7" rel="preload" as="script"><script id="boomr-scr-as" src="./PNWPX-BE9G3-4DHZY-UN976-FJCP7" async=""></script></head>
<body>
  <script id="cookie-name" type="application/json">
    nrk.opsession
  </script>
  <script id="canary-cookie-name" type="application/json">
    nrk.opcanary
  </script>
<script type="text/javascript">

 /* base64x-1.1.14 (c) 2012-2018 Kenji Urushima | kjur.github.com/jsrsasign/license
  * base64x.js - Base64url and supplementary functions for Tom Wu's base64.js library
  * version: 1.1.14 (2018-Apr-21)
  * Copyright (c) 2012-2018 Kenji Urushima (kenji.urushima@gmail.com)
  *
  * This software is licensed under the terms of the MIT License.
  * https://kjur.github.io/jsrsasign/license
  *
  * The above copyright and license notice shall be 
  * included in all copies or substantial portions of the Software.
  */

 function b64tob64u(s) {
     s = s.replace(/\=/g, "");
     s = s.replace(/\+/g, "-");
     s = s.replace(/\//g, "_");
     return s;
 }
 function hextob64u(s) {
     if (s.length % 2 === 1) s = "0" + s;
     return b64tob64u(hex2b64(s));
 }

 var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
 var b64pad="=";

 function hex2b64(h) {
     var i;
     var c;
     var ret = "";
     for(i = 0; i+3 <= h.length; i+=3) {
         c = parseInt(h.substring(i,i+3),16);
         ret += b64map.charAt(c >> 6) + b64map.charAt(c & 63);
     }
     if(i+1 === h.length) {
         c = parseInt(h.substring(i,i+1),16);
         ret += b64map.charAt(c << 2);
     }
     else if(i+2 === h.length) {
         c = parseInt(h.substring(i,i+2),16);
         ret += b64map.charAt(c >> 2) + b64map.charAt((c & 3) << 4);
     }
     if (b64pad) while((ret.length & 3) > 0) ret += b64pad;
     return ret;
 }



/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */
/*  SHA-256 implementation in JavaScript                (c) Chris Veness 2002-2014 / MIT Licence  */
/*                                                                                                */
/*  - see http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html                              */
/*        http://csrc.nist.gov/groups/ST/toolkit/examples.html                                    */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */

/* jshint node:true *//* global define, escape, unescape */
    'use strict';

    /**
* SHA-256 hash function reference implementation.
*
* @namespace
*/
    var Sha256 = {};
    /**
     * Generates SHA-256 hash of string.
     *
     * @param   {string} msg - String to be hashed
     * @returns {string} Hash of msg as hex character string
     */
    Sha256.hash = function (msg) {
        // convert string to UTF-8, as SHA only deals with byte-streams
        msg = msg.utf8Encode();

        // constants [§4.2.2]
        var K = [
            0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,
            0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,
            0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
            0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,
            0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,
            0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
            0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,
            0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2];
        // initial hash value [§5.3.1]
        var H = [
            0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19];

        // PREPROCESSING 

        msg += String.fromCharCode(0x80);  // add trailing '1' bit (+ 0's padding) to string [§5.1.1]

        // convert string msg into 512-bit/16-integer blocks arrays of ints [§5.2.1]
        var l = msg.length / 4 + 2; // length (in 32-bit integers) of msg + ‘1’ + appended length
        var N = Math.ceil(l / 16);  // number of 16-integer-blocks required to hold 'l' ints
        var M = new Array(N);

        for (var i = 0; i < N; i++) {
            M[i] = new Array(16);
            for (var j = 0; j < 16; j++) {  // encode 4 chars per integer, big-endian encoding
                M[i][j] = (msg.charCodeAt(i * 64 + j * 4) << 24) | (msg.charCodeAt(i * 64 + j * 4 + 1) << 16) |
                    (msg.charCodeAt(i * 64 + j * 4 + 2) << 8) | (msg.charCodeAt(i * 64 + j * 4 + 3));
            } // note running off the end of msg is ok 'cos bitwise ops on NaN return 0
        }
        // add length (in bits) into final pair of 32-bit integers (big-endian) [§5.1.1]
        // note: most significant word would be (len-1)*8 >>> 32, but since JS converts
        // bitwise-op args to 32 bits, we need to simulate this by arithmetic operators
        M[N - 1][14] = ((msg.length - 1) * 8) / Math.pow(2, 32); M[N - 1][14] = Math.floor(M[N - 1][14]);
        M[N - 1][15] = ((msg.length - 1) * 8) & 0xffffffff;


        // HASH COMPUTATION [§6.1.2]

        var W = new Array(64); var a, b, c, d, e, f, g, h;
        for (var i = 0; i < N; i++) {

            // 1 - prepare message schedule 'W'
            for (var t = 0; t < 16; t++) W[t] = M[i][t];
            for (var t = 16; t < 64; t++) W[t] = (Sha256.σ1(W[t - 2]) + W[t - 7] + Sha256.σ0(W[t - 15]) + W[t - 16]) & 0xffffffff;

            // 2 - initialise working variables a, b, c, d, e, f, g, h with previous hash value
            a = H[0]; b = H[1]; c = H[2]; d = H[3]; e = H[4]; f = H[5]; g = H[6]; h = H[7];

            // 3 - main loop (note 'addition modulo 2^32')
            for (var t = 0; t < 64; t++) {
                var T1 = h + Sha256.Σ1(e) + Sha256.Ch(e, f, g) + K[t] + W[t];
                var T2 = Sha256.Σ0(a) + Sha256.Maj(a, b, c);
                h = g;
                g = f;
                f = e;
                e = (d + T1) & 0xffffffff;
                d = c;
                c = b;
                b = a;
                a = (T1 + T2) & 0xffffffff;
            }
            // 4 - compute the new intermediate hash value (note 'addition modulo 2^32')
            H[0] = (H[0] + a) & 0xffffffff;
            H[1] = (H[1] + b) & 0xffffffff;
            H[2] = (H[2] + c) & 0xffffffff;
            H[3] = (H[3] + d) & 0xffffffff;
            H[4] = (H[4] + e) & 0xffffffff;
            H[5] = (H[5] + f) & 0xffffffff;
            H[6] = (H[6] + g) & 0xffffffff;
            H[7] = (H[7] + h) & 0xffffffff;
        }

        return Sha256.toHexStr(H[0]) + Sha256.toHexStr(H[1]) + Sha256.toHexStr(H[2]) + Sha256.toHexStr(H[3]) +
            Sha256.toHexStr(H[4]) + Sha256.toHexStr(H[5]) + Sha256.toHexStr(H[6]) + Sha256.toHexStr(H[7]);
    };


    /**
     * Rotates right (circular right shift) value x by n positions [§3.2.4].
     * @private
     */
    Sha256.ROTR = function (n, x) {
        return (x >>> n) | (x << (32 - n));
    };

    /**
     * Logical functions [§4.1.2].
     * @private
     */
    Sha256.Σ0 = function (x) { return Sha256.ROTR(2, x) ^ Sha256.ROTR(13, x) ^ Sha256.ROTR(22, x); };
    Sha256.Σ1 = function (x) { return Sha256.ROTR(6, x) ^ Sha256.ROTR(11, x) ^ Sha256.ROTR(25, x); };
    Sha256.σ0 = function (x) { return Sha256.ROTR(7, x) ^ Sha256.ROTR(18, x) ^ (x >>> 3); };
    Sha256.σ1 = function (x) { return Sha256.ROTR(17, x) ^ Sha256.ROTR(19, x) ^ (x >>> 10); };
    Sha256.Ch = function (x, y, z) { return (x & y) ^ (~x & z); };
    Sha256.Maj = function (x, y, z) { return (x & y) ^ (x & z) ^ (y & z); };


    /**
     * Hexadecimal representation of a number.
     * @private
     */
    Sha256.toHexStr = function (n) {
        // note can't use toString(16) as it is implementation-dependant,
        // and in IE returns signed numbers when used on full words
        var s = '', v;
        for (var i = 7; i >= 0; i--) { v = (n >>> (i * 4)) & 0xf; s += v.toString(16); }
        return s;
    };


    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */


    /** Extend String object with method to encode multi-byte string to utf8
     *  - monsur.hossa.in/2012/07/20/utf-8-in-javascript.html */
    if (typeof String.prototype.utf8Encode == 'undefined') {
        String.prototype.utf8Encode = function () {
            return unescape(encodeURIComponent(this));
        };
    }

    /** Extend String object with method to decode utf8 string to multi-byte */
    if (typeof String.prototype.utf8Decode == 'undefined') {
        String.prototype.utf8Decode = function () {
            try {
                return decodeURIComponent(escape(this));
            } catch (e) {
                return this; // invalid UTF-8? return as-is
            }
        };
    }


    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */
    if (typeof module != 'undefined' && module.exports) module.exports = Sha256; // CommonJs export
    if (typeof define == 'function' && define.amd) define([], function () { return Sha256; }); // AMD


  (function () {

    var cookieName = document.getElementById("cookie-name").textContent.trim();
    var canaryCookieName = document.getElementById("canary-cookie-name").textContent.trim();
    var canaryWasKilled = false;

        function getCookies() {
            var allCookies = document.cookie;
            var cookies = allCookies.split(';');
            return cookies.map(function (value) {
                var parts = value.trim().split('=');
                if (parts.length === 2) {
                    return {
                        name: parts[0].trim(),
                        value: parts[1].trim()
                    };
                }
            }).filter(function (item) {
                return item && item.name && item.value;
            });
        }

        function getBrowserSessionId() {
          var cookies = getCookies().filter(function (cookie) {
            return (cookie.name === cookieName);
          });
          return cookies[0] && cookies[0].value;
      }
        function getSessionCanaryIsStillChirping() {
          var cookies = getCookies().filter(function (cookie) {
            return (cookie.name === canaryCookieName);
          });
          return cookies[0] && cookies[0].value === "1";
        }


        function hash(value) {
            var h = Sha256.hash(value);
            return hextob64u(h);
        }

        function computeSessionStateHash(clientId, origin, sessionId, salt) {
            return hash(clientId + origin + sessionId + salt);
        }

        function calculateSessionStateResult(origin, message) {
            try {
                if (!origin) {
                    return null;
                }

                var messageParts = message.split(' ');
                if (messageParts.length !== 2) {
                    return null;
                }

                var clientId = messageParts[0];
                var sessionState = messageParts[1];
                
                if (!clientId || !sessionState) {
                    return null;
                }

                if (!getSessionCanaryIsStillChirping()) {
                  if (!canaryWasKilled) {
                    console.log("Session canary is dead, aborting sso-automation");
                  }
                  canaryWasKilled = true;
                  return null;
                } else {
                  canaryWasKilled = false;
                }

                var currentSessionId = getBrowserSessionId();
                
                if (sessionState === "none") {
                    return !currentSessionId ? "unchanged" : "changed";
                }

                var sessionStateParts = sessionState.split('.');
                if (sessionStateParts.length !== 2) {
                    return null;
                }

                var clientHash = sessionStateParts[0];
                var salt = sessionStateParts[1];
                if (!clientHash || !salt) {
                    return null;
                }

                if (!currentSessionId) {
                    return "ended";
                }

                var expectedHash = computeSessionStateHash(clientId, origin, currentSessionId, salt);
                
                if (clientHash === expectedHash){
                  return "unchanged";
                }
  
                console.log("opsession: session changed");
                console.log(`opsession: clientId: '${clientId}'`);
                console.log(`opsession: expectedHash: '${expectedHash}'`);
                console.log(`opsession: clientHash:   '${clientHash}'`);
                return "changed";
            }
            catch (e) {
                return "error";
            }
        }

        if (canaryCookieName && cookieName && window.parent !== window) {
            window.addEventListener("message", function (e) {
                if (typeof (e.data) !== "string") {
                    return; //ignore
                }
                
                var result = calculateSessionStateResult(e.origin, e.data);
                if (result === null) {
                    return; //ignore
                }
                e.source.postMessage(result, e.origin);
            }, false);
        }
    })();
</script>

</body></html>